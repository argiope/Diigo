<?php

class Diigo_API {
  $methods = array('get_bookmarks', 'post_bookmark');
  $api_url = 'https://secure.diigo.com/api/v2/bookmarks';
  function __construct($method = FALSE, $account = FALSE, $options = FALSE){
    //check to see if there is a method, $account or options
    $error_free = FALSE;
    $error = '';
    $params = '';
    if(is_string($method) && is_array($options) && is_array($account)){
      if(array_search($method, $this->methods)){
        $error_free = TRUE;
      }
      else {
        $error = 'No Method.'
      }
    }
    else{
      $error = 'Wrong type of variables passed for either $method or $options.'
    }
    if($error_free == TRUE){
      foreach($options as $param => $value){
        $params .= $param.'='.$value.'&';
      }
      //unsetting for each variables to prevent weird php stuff
      unset($param);
      unset($value);
      //triming the last &
      $params = rtrim($params, '&');
      //
      $responce = $this->$method($params, $options, $account);
      if(is_string($responce)){
        return $responce;
      }
      else
      {
        $this->theme($responce);
      }
    }
    else {
      return $error;
    }
  }
  function get_bookmarks($params, $options, $account){
    //secure auth info
    $auth = array('Authorization:' => 'Basic '.base64_encode($account['name'].':'.$account['pass']).'\r\n');
    //gets bookmarks
    $http_opts = array(
      'headers' => $auth,
      'method' => 'GET',
      'data' => $params,
    )
    $responce = drupal_http_request($this->api_url, $http_opts);
    if($responce->code != '404'){
      return 'responce error code:' . $responce->code;
    }
    else
    {
      return json_decode($responce->data);
    }
  }
  function post_bookmark($params, $options, $account){
    //Posts Bookmark to account
    //drupal_http_request();
  }
  function theme($responce){
    //pss to some themeing function
  }
}

